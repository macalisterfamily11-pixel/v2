<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Панель Оператора - BNR Bank</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/console.css">
</head>
<body class="console-dashboard">
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background: rgba(0, 105, 92, 0.95);">
        <div class="container">
            <a class="navbar-brand" href="dashboard.html">
                <i class="fas fa-university me-2"></i>
                <strong>BNR Bank</strong>
                <span class="ms-2 badge bg-light text-dark">Оператор</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="dashboard.html">
                            <i class="fas fa-tachometer-alt me-1"></i> Дашборд
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cases.html">
                            <i class="fas fa-clipboard-list me-1"></i> Мои дела
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="tasks.html">
                            <i class="fas fa-tasks me-1"></i> Задачи
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="consoleDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-tie me-1"></i>
                            <span id="consoleName">Оператор</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" href="#" onclick="showConsoleProfile()">
                                    <i class="fas fa-user me-2"></i> Профиль
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" onclick="showSettings()">
                                    <i class="fas fa-cog me-2"></i> Настройки
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="../auth/logout.html">
                                    <i class="fas fa-sign-out-alt me-2"></i> Выйти
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Хедер -->
    <div class="console-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-6 fw-bold console-welcome">
                        <i class="fas fa-user-tie me-2"></i>
                        Панель Оператора
                    </h1>
                    <p class="lead mb-0">
                        Обработка заявок на аннуляцию кредитов
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="console-bank-badge">
                        <i class="fas fa-bank me-1"></i>
                        <span id="consoleBank">BNR</span>
                        <span class="ms-2" id="consoleRole">Специалист</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Основной контент -->
    <div class="container mt-4">
        <!-- Статистика -->
        <div class="console-stats">
            <div class="console-stat-card assigned">
                <div class="console-stat-icon assigned">
                    <i class="fas fa-folder-open"></i>
                </div>
                <h3 id="assignedCases">0</h3>
                <p class="text-muted mb-0">Назначено дел</p>
                <small class="text-primary">+3 новых</small>
            </div>
            
            <div class="console-stat-card review">
                <div class="console-stat-icon review">
                    <i class="fas fa-search"></i>
                </div>
                <h3 id="reviewCases">0</h3>
                <p class="text-muted mb-0">На проверке</p>
                <small class="text-warning">Требуют внимания</small>
            </div>
            
            <div class="console-stat-card urgent">
                <div class="console-stat-icon urgent">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 id="urgentCases">0</h3>
                <p class="text-muted mb-0">Срочные</p>
                <small class="text-danger">Высокий приоритет</small>
            </div>
            
            <div class="console-stat-card completed">
                <div class="console-stat-icon completed">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 id="completedCases">0</h3>
                <p class="text-muted mb-0">Завершено</p>
                <small class="text-success">В этом месяце</small>
            </div>
        </div>

        <!-- Срочные задачи -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-circle me-2 text-danger"></i>
                    Срочные задачи
                </h5>
                <a href="cases.html?priority=urgent" class="btn btn-sm btn-outline-danger">
                    Все срочные <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            <div class="card-body p-0">
                <div id="urgentTasks">
                    <!-- Данные загружаются через JS -->
                    <div class="text-center py-5">
                        <i class="fas fa-check-circle fa-2x text-muted mb-3"></i>
                        <h5>Нет срочных задач</h5>
                        <p class="text-muted">Все дела обрабатываются в обычном режиме</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Активные дела -->
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-clock me-2 text-primary"></i>
                            Активные дела
                        </h5>
                        <a href="cases.html" class="btn btn-sm btn-primary">
                            Все дела <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Номер дела</th>
                                        <th>Клиент</th>
                                        <th>Тип</th>
                                        <th>Приоритет</th>
                                        <th>Срок</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="activeCasesTable">
                                    <!-- Данные загружаются через JS -->
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <i class="fas fa-spinner fa-spin me-2"></i>
                                            Загрузка данных...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Быстрые действия -->
            <div class="col-lg-4">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">
                            <i class="fas fa-bolt me-2"></i>
                            Быстрые действия
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-success" onclick="takeNewCase()">
                                <i class="fas fa-plus-circle me-2"></i> Взять новое дело
                            </button>
                            <button class="btn btn-primary" onclick="viewAssignedCases()">
                                <i class="fas fa-list me-2"></i> Мои назначенные дела
                            </button>
                            <button class="btn btn-outline-primary" onclick="addNote()">
                                <i class="fas fa-sticky-note me-2"></i> Добавить заметку
                            </button>
                            <button class="btn btn-outline-secondary" onclick="requestDocuments()">
                                <i class="fas fa-file-import me-2"></i> Запросить документы
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Прогресс дня -->
                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>
                            Прогресс за сегодня
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>Обработано дел</span>
                                <span id="todayProcessed">0/8</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-success" id="processedProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>Одобрено</span>
                                <span id="todayApproved">0</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-primary" id="approvedProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>На доработке</span>
                                <span id="todayRevision">0</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-warning" id="revisionProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Цель дня: 8 дел
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Футер -->
    <footer class="bg-light border-top mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <span class="text-muted">
                        <i class="fas fa-university me-1"></i>
                        BNR Bank - Панель Оператора
                        <span id="footerBankInfo" class="ms-2"></span>
                    </span>
                </div>
                <div class="col-md-6 text-end">
                    <span class="text-muted">
                        <i class="fas fa-clock me-1"></i>
                        <span id="currentTime">00:00:00</span>
                        | <i class="fas fa-globe me-1"></i> RU
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Mock данные для оператора
        const consoleData = {
            stats: {
                assigned: 12,
                review: 4,
                urgent: 2,
                completed: 8
            },
            urgentTasks: [
                {
                    id: 1,
                    number: 'CASE-2024-012',
                    client: 'Елена Маринеску',
                    type: 'Ипотечный кредит',
                    amount: 120000,
                    priority: 'urgent',
                    deadline: 'Сегодня, 18:00',
                    description: 'Требуется срочная проверка дополнительных документов'
                },
                {
                    id: 2,
                    number: 'CASE-2024-015',
                    client: 'Ион Попеску',
                    type: 'Потребительский кредит',
                    amount: 150000,
                    priority: 'urgent',
                    deadline: 'Завтра, 10:00',
                    description: 'Клиент ожидает ответ по срочному запросу'
                }
            ],
            activeCases: [
                {
                    id: 1,
                    number: 'CASE-2024-014',
                    client: 'Мария Ионеску',
                    type: 'Автокредит',
                    priority: 'high',
                    deadline: '17.01.2024',
                    status: 'review'
                },
                {
                    id: 2,
                    number: 'CASE-2024-013',
                    client: 'Андрей Георгеску',
                    type: 'Кредит на обучение',
                    priority: 'medium',
                    deadline: '20.01.2024',
                    status: 'pending'
                },
                {
                    id: 3,
                    number: 'CASE-2024-011',
                    client: 'Михай Думитреску',
                    type: 'Потребительский кредит',
                    priority: 'medium',
                    deadline: '25.01.2024',
                    status: 'review'
                },
                {
                    id: 4,
                    number: 'CASE-2024-010',
                    client: 'Ана Станку',
                    type: 'Ипотечный кредит',
                    priority: 'high',
                    deadline: '28.01.2024',
                    status: 'pending'
                }
            ],
            todayProgress: {
                processed: 5,
                total: 8,
                approved: 2,
                revision: 1
            }
        };

        // Проверка авторизации
        document.addEventListener('DOMContentLoaded', function() {
            const user = JSON.parse(localStorage.getItem('user'));
            const bank = JSON.parse(localStorage.getItem('selectedBank'));
            
            if (!user || user.role !== 'console') {
                window.location.href = '../auth/login.html';
                return;
            }
            
            // Установка данных оператора
            document.getElementById('consoleName').textContent = 
                user.firstName && user.lastName ? `${user.firstName} ${user.lastName}` : user.username;
            
            document.getElementById('consoleRole').textContent = 'Специалист';
            
            // Установка данных банка
            if (bank) {
                document.getElementById('consoleBank').textContent = bank.code;
                document.getElementById('footerBankInfo').textContent = bank.name;
            }
            
            // Обновление времени
            function updateTime() {
                const now = new Date();
                document.getElementById('currentTime').textContent = 
                    now.toLocaleTimeString('ru-RU');
            }
            updateTime();
            setInterval(updateTime, 1000);
            
            // Загрузка данных
            loadConsoleDashboard();
        });

        // Загрузка данных панели оператора
        function loadConsoleDashboard() {
            // Статистика
            document.getElementById('assignedCases').textContent = consoleData.stats.assigned;
            document.getElementById('reviewCases').textContent = consoleData.stats.review;
            document.getElementById('urgentCases').textContent = consoleData.stats.urgent;
            document.getElementById('completedCases').textContent = consoleData.stats.completed;
            
            // Срочные задачи
            loadUrgentTasks();
            
            // Активные дела
            loadActiveCases();
            
            // Прогресс дня
            updateTodayProgress();
        }

        // Загрузка срочных задач
        function loadUrgentTasks() {
            const urgentTasksDiv = document.getElementById('urgentTasks');
            
            if (consoleData.urgentTasks.length === 0) {
                urgentTasksDiv.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-check-circle fa-2x text-muted mb-3"></i>
                        <h5>Нет срочных задач</h5>
                        <p class="text-muted">Все дела обрабатываются в обычном режиме</p>
                    </div>
                `;
                return;
            }
            
            let tasksHTML = '';
            consoleData.urgentTasks.forEach(task => {
                tasksHTML += `
                    <div class="task-card urgent">
                        <div class="task-header">
                            <div>
                                <div class="task-client">${task.client}</div>
                                <div class="task-type">${task.type}</div>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-danger">СРОЧНО</span>
                            </div>
                        </div>
                        
                        <div class="task-details">
                            <div class="task-amount">${task.amount.toLocaleString('ru-RU')} RON</div>
                            <div class="task-description">${task.description}</div>
                        </div>
                        
                        <div class="task-footer">
                            <div>
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    ${task.deadline}
                                </small>
                            </div>
                            <div class="task-actions">
                                <button class="action-btn primary" onclick="openCase(${task.id})">
                                    Открыть
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            urgentTasksDiv.innerHTML = tasksHTML;
        }

        // Загрузка активных дел
        function loadActiveCases() {
            const tableBody = document.getElementById('activeCasesTable');
            
            let casesHTML = '';
            consoleData.activeCases.forEach(caseItem => {
                const priorityClass = `priority-${caseItem.priority}`;
                const priorityText = caseItem.priority === 'urgent' ? 'Срочно' :
                                   caseItem.priority === 'high' ? 'Высокий' :
                                   caseItem.priority === 'medium' ? 'Средний' : 'Низкий';
                
                casesHTML += `
                    <tr>
                        <td>
                            <strong>${caseItem.number}</strong>
                        </td>
                        <td>${caseItem.client}</td>
                        <td>${caseItem.type}</td>
                        <td>
                            <span class="priority-badge ${priorityClass}">
                                ${priorityText}
                            </span>
                        </td>
                        <td>${caseItem.deadline}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="openCase(${caseItem.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="processCase(${caseItem.id})">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = casesHTML;
        }

        // Обновление прогресса дня
        function updateTodayProgress() {
            const progress = consoleData.todayProgress;
            
            document.getElementById('todayProcessed').textContent = 
                `${progress.processed}/${progress.total}`;
            document.getElementById('todayApproved').textContent = progress.approved;
            document.getElementById('todayRevision').textContent = progress.revision;
            
            const processedPercent = (progress.processed / progress.total) * 100;
            const approvedPercent = (progress.approved / progress.total) * 100;
            const revisionPercent = (progress.revision / progress.total) * 100;
            
            document.getElementById('processedProgress').style.width = `${processedPercent}%`;
            document.getElementById('approvedProgress').style.width = `${approvedPercent}%`;
            document.getElementById('revisionProgress').style.width = `${revisionPercent}%`;
        }

        // Показать профиль оператора
        function showConsoleProfile() {
            alert('Редактирование профиля оператора');
        }

        // Показать настройки
        function showSettings() {
            alert('Настройки оператора');
        }

        // Взять новое дело
        function takeNewCase() {
            alert('Выбор нового дела для обработки...');
        }

        // Просмотр назначенных дел
        function viewAssignedCases() {
            window.location.href = 'cases.html';
        }

        // Добавить заметку
        function addNote() {
            alert('Добавление новой заметки...');
        }

        // Запросить документы
        function requestDocuments() {
            alert('Формирование запроса документов...');
        }

        // Открыть дело
        function openCase(caseId) {
            alert(`Открытие дела ${caseId}...`);
            // В реальном приложении здесь был бы переход на страницу дела
        }

        // Обработать дело
        function processCase(caseId) {
            alert(`Начало обработки дела ${caseId}...`);
        }
    </script>
</body>
</html>